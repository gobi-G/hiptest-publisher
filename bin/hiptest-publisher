#!/usr/bin/env ruby

# Don't try to run this binary directly. Instead:
#
#   * `hiptest-publisher` if installed through rubygems, relying on the rubygem
#     wrapper
#
#   * `bundle exec ruby -I lib bin/hiptest-publisher` if doing hiptest-publisher
#     development. You can define an alias for this command and run it as if
#     you were running the gem natively.
#
#         alias hiptest-publisher='bundle exec ruby -I lib bin/hiptest-publisher'
#

require 'ruby_version'
require 'hiptest-publisher/i18n'
require 'hiptest-publisher/utils'

# Ensure ruby version >= 2.7
if RubyVersion < '2.7.0'
  STDERR.puts("Ruby 2.7.0 or higher is required.")
  STDERR.puts("Using #{RUBY_ENGINE} #{RUBY_VERSION}.")
  STDERR.puts("Please use a more recent version of Ruby.")

  if RubyVersion.is? 2.6
    STDERR.puts('Support for Ruby 2.6.0 ended on 2022-03-31')
  elsif RubyVersion.is? 2.5
    STDERR.puts('Support for Ruby 2.5.0 ended on 2021-03-31')
  elsif RubyVersion.is? 2.4
    STDERR.puts('Support for Ruby 2.4.0 ended on 2020-03-31')
  end
  exit 1
end

if RubyVersion < '3.0'
  STDERR.puts("Using #{RUBY_ENGINE} #{RUBY_VERSION}.")
  STDERR.puts("Warning: Ruby 2.7 is deprecated and will not be supported in future versions.")
  STDERR.puts("Support for Ruby 2.7 ended on 2023-03-31")
end

require 'hiptest-publisher'
begin
  require 'pry' # only available in development
rescue StandardError, LoadError
end

Hiptest::Publisher.new(ARGV).run
